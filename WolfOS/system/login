--[[WolfOS is the intellectual property of James Chapman (toxic.wolf@hotmail.co.uk).
Please ask for permission before attempting to redistribute any code relating to WolfOS IN ANY FORM.]]--

WUI.clear("Startup Menu")
WUI.slowPrint("Please enter your User Account ID:", 1, 4)
WUI.registerTextField(6, "[%w%.%-_]", 16, false)
WUI.slowPrint("Please enter your Passcode:", 1, 8)
WUI.registerTextField(10, "%w", 16, true)
local t = WUI.getText(true)
if t then
	local sUserInput, sPassInput = t[1], t[2]
	local tUser, p1, p2 = WAU.checkLogin(sUserInput, hash.sha256(sPassInput))
	WUI.clear("Startup Menu")
	if tUser then
		WUI.slowPrint("Logging in...", nil, nil, true)
		WDM.writeSystemTemp(tUser.uid, "current_uid")
		WDM.writeSystemTemp(tUser.name, "current_user")
		WDM.writeSystemTemp(tUser.hash, "current_hash")
		WDM.writeSystemTemp(tUser.type, "current_type")
		os.run({}, WDM.getSystemDir("system") .. "mainMenu")
	elseif p2 ~= "invalid_user" then
		WUI.clear("Startup Menu")
		WUI.slowPrint("Could not connect to Mainframe: \n")
		WUI.slowPrint("> " .. p1 .. ": " .. p2 .. "\n")
		if WUI.choiceMenu("Switch to Offline Mode?") then
			WDM.writeSystemData(true, "offline")
		end
		os.run({}, WDM.getSystemDir("system") .. "startupMenu")
	else
		WUI.slowPrint("Incorrect User Account ID or Passcode!", nil, nil, true)
		os.run({}, WDM.getSystemDir("system") .. "startupMenu")
	end
else
	os.run({}, WDM.getSystemDir("system") .. "startupMenu")
end