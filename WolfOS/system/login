--[[WolfOS is the intellectual property of James Chapman (toxic.wolf@hotmail.co.uk).
Please ask for permission before attempting to redistribute any code relating to WolfOS IN ANY FORM.]]--

WUI.clear("Startup Menu")
WUI.slowPrint("Please enter your User Account ID:", 1, 4)
WUI.registerTextField(6, "[%w%.%-_]", 16, false)
WUI.slowPrint("Please enter your Passcode:", 1, 8)
WUI.registerTextField(10, "%w", 16, true)
local t = WUI.getText(true)
if t then
	local sUserInput, sPassInput = t[1], t[2]
	local tUser
	if WDM.readSystemData("offline") then
		tUser = WAU.checkLogin(sUserInput, hash.sha256(sPassInput))
	else
		WNC.send(WDM.readSystemData("mainframe_id"), "connection_request", sUserInput, hash.sha256(sPassInput))
		local nSenderID, sEvent, p1 = WNC.receive(WDM.readSystemData("mainframe_id"), 10)
		tUser = p1
		if sEvent == "connection_failure" then
			if p1 == "invalid_user" then
				tUser = nil
			else
				WUI.clear("Startup Menu")
				WUI.slowPrint("Could not connect to Mainframe: \n")
				WUI.slowPrint("> " .. sEvent .. ": " .. p1 .. "\n")
				if WUI.choiceMenu("Switch to Offline Mode?") then
					WDM.writeSystemData(true, "offline")
				end
			end
		end
	end
	WUI.clear("Startup Menu")
	if type(tUser) == "table" then
		WUI.slowPrint("Logging in...", nil, nil, true)
		WDM.writeSystemTemp(tUser.uid, "current_uid")
		WDM.writeSystemTemp(tUser.name, "current_user")
		WDM.writeSystemTemp(tUser.hash, "current_hash")
		WDM.writeSystemTemp(tUser.type, "current_type")
		os.run({}, WDM.getSystemDir("system") .. "mainMenu")
	else
		if not tUser then
			WUI.slowPrint("Incorrect User Account ID or Passcode!", nil, nil, true)
		end
		os.run({}, WDM.getSystemDir("system") .. "startupMenu")
	end
else
	os.run({}, WDM.getSystemDir("system") .. "startupMenu")
end