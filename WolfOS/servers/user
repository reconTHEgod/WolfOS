--[[WolfOS is the intellectual property of James Chapman (toxic.wolf@hotmail.co.uk).
Please ask for permission before attempting to redistribute any code relating to WolfOS IN ANY FORM.]]--

--WolfOS User Server Module

while true do
	if WDM.readServerData("user_state") then
		local nSenderID, sEvent, p1, p2, p3, p4, p5 = WNC.receive()
		if sEvent == "connection_request" then
			local tUser = WAU.checkLogin(p1, p2)
			if tUser then
				WNC.send(nSenderID, "connection_success", tUser)
			else
				WNC.send(nSenderID, "connection_failure", "invalid_user")
			end
		elseif sEvent == "data_request" then
			if p1 == "user_list" then
				if WAU.exists(p2)["type"] == "admin" then
					WNC.send(nSenderID, "data_success", textutils.unserialize(encryption.fromBase64(WDM.readAllText(WDM.getSystemDir("data") .. "users.dat"))))
				else
					WNC.send(nSenderID, "data_failure", "unauthorised_user")
				end
			elseif p1 == "user_data" then
				WNC.send(nSenderID, "data_success", WAU.exists(p2))
			end
		end
	else
		sleep(1)
	end
end